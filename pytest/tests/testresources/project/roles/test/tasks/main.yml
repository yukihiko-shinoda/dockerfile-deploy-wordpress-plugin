---
- name: Checkout svn repository
  subversion:
    repo: '{{ svn_repository_url }}'
    dest: /root/workdir/project-in-svn
    revision: '3'
    force: yes

- name: Check file status which should be deployed
  stat:
    path: /root/workdir/project-in-svn/tags/0.4.5/images/options32.png
  register: file_should_be_deployed

- name: Assert
  fail:
    msg: The file which sould be deployed doesn't exist!
  when: not file_should_be_deployed.stat.exists

- name: Checkout svn repository
  subversion:
    repo: '{{ svn_repository_url }}'
    dest: /root/workdir/project-in-svn
    revision: '2'
    force: yes

- name: Check file status which should be deleted
  stat:
    path: /root/workdir/project-in-svn/trunk/includes/class-admin-menu.php
  register: file_should_be_deleted

- name: Assert
  fail:
    msg: The file which sould be deleted exists!
  when: file_should_be_deleted.stat.exists

- name: Check file status which should be added
  stat:
    path: /root/workdir/project-in-svn/trunk/images/staticpress.png
  register: file_should_be_added

- name: Assert
  fail:
    msg: The file which sould be added doesn't exist!
  when: not file_should_be_added.stat.exists

# @see https://stackoverflow.com/a/43872222
- name: Check file status which should be modified
  lineinfile:
    name: /root/workdir/project-in-svn/trunk/includes/class-InputValidator.php
    line: require_once(dirname(__FILE__).'/class-WP_Function_Wrapper.php');
  check_mode: yes
  register: file_should_be_modified
  failed_when: (file_should_be_modified is not changed) and (file_should_be_modified is not failed)

- name: Check file status which should not be deployed
  stat:
    path: /root/workdir/project-in-svn/tags/0.4.2/images/options32.png
  register: file_should_not_be_deployed

- name: Assert
  fail:
    msg: The file which sould not be deployed exists!
  when: file_should_not_be_deployed.stat.exists

- name: Checkout svn repository
  subversion:
    repo: '{{ svn_repository_url }}'
    dest: /root/workdir/project-in-svn
    revision: '1'
    force: yes

- name: Check file status which should be deleted
  stat:
    path: /root/workdir/project-in-svn/trunk/includes/class-admin-menu.php
  register: file_should_be_deleted

- name: Assert
  fail:
    msg: The file which sould be deleted doesn't exist!
  when: not file_should_be_deleted.stat.exists

- name: Check file status which should be added
  stat:
    path: /root/workdir/project-in-svn/trunk/images/staticpress.png
  register: file_should_be_added

- name: Assert
  fail:
    msg: The file which sould be added exists!
  when: file_should_be_added.stat.exists

# @see https://stackoverflow.com/a/43872222
- name: Check file status which should be modified
  lineinfile:
    name: /root/workdir/project-in-svn/trunk/includes/class-InputValidator.php
    line: require_once(dirname(__FILE__).'/class-WP_Function_Wrapper.php');
  check_mode: yes
  register: file_should_be_modified
  failed_when: (file_should_be_modified is changed) or (file_should_be_modified is failed)

- name: Check file status which should be deployed
  stat:
    path: /root/workdir/project-in-svn/tags/0.4.1/images/options32.png
  register: file_should_be_deployed

- name: Assert
  fail:
    msg: The file which sould be deployed doesn't exist!
  when: not file_should_be_deployed.stat.exists
